# hh-hibernate-jdbc

В качестве домашнего задания был реализован процесс регистрации аварий на линиях электропередач специально предназначенными для этого приборами.

## Сущности

В процессе используются три сущности:

**Прибор (device)**. Свойства прибора:
 * серийный номер (sn)
 * местоположение (location), которое задано номером отпайки (branch line) и номером опоры (pillar)

**Авария (fault)**. Свойства:
 * тип (type), например это может быть короткое замыкание (short circuit) или замыкание на землю (earth fault), с обозначением повреждённых фаз (L1, L2, L3)
 * время возникновения аварии (occurrence_time) 

**Фиксация аварии прибором (detection)**. Свойства:
 * идентификатор прибора, зафиксировавшего аварию
 * идентификатор аварии, зафиксированной прибором
 * время фиксации (detection_time)
 
Работа с приборами осуществляется через Spring JDBC. С авариями и фиксациями - через Hibernate.
 
## Сервисы и транзакции
 
Реализованы сервисы для аварий и фиксаций аварий.
 
При появлении новой аварии сервис аварий (FaultService) обращается в транзакции к сервису фиксаций (DetectionService) для того, чтобы сервис фиксаций указал какими приборами была зафиксирована данная авария (DetectionService.register()).
В данном примере, сервис фиксаций берёт случайный набор приборов.

## Сборка приложения

Перед запуском приложения необходимо его собрать с помощью `mvn install`.

**Внимание**: во время сборки приложения будет запущен скрипт создания БД и таблиц.
Поэтому для того чтобы проект собрался без ошибок, необходимо чтобы на локальной машине был запущен PostgreSQL.
(Проект был протестирован с версией PostgreSQL 9.6.7.)
Так же будет создана новая роль в PostgreSQL, для которой во время сборки необходимо будет ввести пароль и повторить ввод.

## Запуск приложения и выполнение примеров

После запуска приложения будет запущена функция play(). Её задача - проверить что есть возможность добавить прибор, поменять ему серийный номер и удалить прибор.

После этого запустится функция fill() - она заполнит таблицу devices некоторым количеством приборов.
Далее будет добавлено несколько аварий.

Потом запустится функция reportDetections(), которая перечислит все фиксации аварий, указав данные о приборе и об аварии.
